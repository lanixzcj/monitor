{% extends 'base_without_header.html' %}
{% load staticfiles %}
{% block files %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
<script type="text/javascript">

$(document).ready(function () {
    var disk = $('#disk-slider').slider().data('slider');
    var cpu = $('#cpu-slider').slider().data('slider');
    var mem = $('#mem-slider').slider().data('slider');
    var bytes_in = $('#bytes-in-slider').slider().data('slider');
    var bytes_out = $('#bytes-out-slider').slider().data('slider');

    $("#disk-slider").on("slide", function(slideEvt) {
	    $("#DiskSliderVal").text(slideEvt.value);
    });
    $("#cpu-slider").on("slide", function(slideEvt) {
	    $("#CpuSliderVal").text(slideEvt.value);
    });
    $("#mem-slider").on("slide", function(slideEvt) {
	    $("#MemSliderVal").text(slideEvt.value);
    });
    $("#bytes-in-slider").on("slide", function(slideEvt) {
	    $("#BytesInSliderVal").text(slideEvt.value);
    });
    $("#bytes-out-slider").on("slide", function(slideEvt) {
	    $("#BytesOutSliderVal").text(slideEvt.value);
    });

    $("form#safe_strategy_form").submit(function() {

        $this = $(this);

        var data = $this.serialize() + '&disk_used=' + disk.getValue() +
                                   '&cpu_used=' + cpu.getValue() +
                                   '&mem_used=' + mem.getValue() +
                                   '&bytes_in=' + bytes_in.getValue() +
                                   '&bytes_out=' + bytes_out.getValue();
        console.log(data)
        $.ajax({
            type: 'POST',
            url: $this.attr('action'),
            data: data,
            success: function (response) {
                console.log(response)
                alert(response)
            }
        });

        return false;

    })

    $('#save-btn').on('click', function() {
        console.log(disk.getValue(), cpu.getValue(), mem.getValue())

        $("form#safe_strategy_form").submit();
    })


    $("#btnAdd").bind('click', function (e) {
        $("#tablePxe tbody").append(
            '<tr><td><input type="checkbox"></td> \
                 <td><select class="selectpicker"> \
                      <option>INPUT</option> \
                      <option>FORWORD</option> \
                      <option>OUTPUT</option>\
                    </select></td>\
                 <td><input></td></tr>'
        );
        $('.selectpicker').selectpicker();
    });
    // 删除设备点击事件
    $("#btnDel").bind('click', function (e) {
        $("#tablePxe tbody :checkbox:checked").each(function (index, element) {
            $(this).closest("tr").remove();
        });
    });
    // 全选框点击事件
    $("#checkAll").bind('click', function (e) {
        $(":checkbox", $("#tablePxe tbody")).prop('checked', this.checked);
        console.log(this.checked);
    });
})
</script>
<style type="text/css">
body {
    padding-top: 50px;
}
ul li {
    list-style-type:none;
}
#Slider .slider-selection {
	background: #BABABA;
}
.table th, .table td {
    text-align: center;
    vertical-align: middle!important;
}
</style>
{% endblock %}
{% block main_content %}
<nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="min-height: 30px">
    <div class="container-fluid">
        <ul class="nav nav-tabs" id="tabs">
            <li class="active"><a href="#device" aria-controls="device" role="tab"
                                  data-toggle="tab">设备</a></li>
            <li><a href="#process" aria-controls="process" role="tab" data-toggle="tab">进程</a></li>
            <li><a href="#file" aria-controls="file" role="tab" data-toggle="tab">文件</a></li>
            <li><a href="#ippackets" aria-controls="ippackets" role="tab" data-toggle="tab">ip包</a>
            </li>
        </ul>
    </div>
</nav>

<div class="tab-content" style="padding: 0 20px 0 20px">
    <div role="tabpanel" class="tab-pane active" id="device">
        <form action="" role="form" name="form" id="safe_strategy_form" method="post"> {% csrf_token %}
            <input type="hidden" name="hostname" value="{{ host }}">

            <ul class="list-group">
            <li class="list-group-item-heading"><strong>硬盘监控</strong></li>
            <li class="list-group-item">
                硬盘使用阀值：<input id="disk-slider" data-slider-id='Slider' type="text"
                       data-slider-min="0" data-slider-max="{{ threshold.disk_total }}"
                       data-slider-step="1" data-slider-value="{{ threshold.disk_used }}"/>
                <span id="DiskSliderValLabel">当前值: <span id="DiskSliderVal">{{ threshold.disk_used }}</span> GB</span>
            </li>
            <li class="list-group-item-heading"><strong>CPU监控</strong></li>
            <li class="list-group-item">
                CPU使用阀值：<input id="cpu-slider" data-slider-id='Slider' type="text"
                       data-slider-min="0" data-slider-max="100" data-slider-step="1"
                       data-slider-value="{{ threshold.cpu_used }}"/>
                <span id="CpuSliderValLabel">当前值: <span id="CpuSliderVal">{{ threshold.cpu_used }}</span> %</span>
            <li class="list-group-item-heading"><strong>内存监控</strong></li>
            </li>
                <li class="list-group-item">
                内存使用阀值：<input id="mem-slider" data-slider-id='Slider' type="text"
                       data-slider-min="0" data-slider-max="{{ threshold.mem_total }}"
                       data-slider-step="1" data-slider-value="{{ threshold.mem_used }}"/>
                    <span id="MemSliderValLabel">当前值: <span id="MemSliderVal">{{ threshold.mem_used }}</span> KB</span>
            </li>
                <li class="list-group-item-heading"><strong>网络监控</strong></li>
            </li>
                <li class="list-group-item">
                下载阀值：<input id="bytes-in-slider" data-slider-id='Slider' type="text"
                       data-slider-min="0" data-slider-max="{{ threshold.bytes_in_max }}"
                       data-slider-step="1" data-slider-value="{{ threshold.bytes_in }}"/>
                    <span id="BytesInSliderValLabel">当前值: <span id="BytesInSliderVal">{{ threshold.bytes_in }}</span> KB</span>
                <br><br>上传阀值：<input id="bytes-out-slider" data-slider-id='Slider' type="text"
                   data-slider-min="0" data-slider-max="{{ threshold.bytes_out_max }}"
                   data-slider-step="1" data-slider-value="{{ threshold.bytes_out }}"/>
                <span id="BytesOutSliderValLabel">当前值: <span id="BytesOutSliderVal">{{ threshold.bytes_out }}</span> KB</span>
            </li>
            </ul>
            <div class="modal-footer">
                <button id="save-btn" type="button" class="btn btn-primary">保存</button>
            </div>
        </form>
    </div>
    <div role="tabpanel" class="tab-pane" id="process">

    </div>
    <div role="tabpanel" class="tab-pane" id="file">

    </div>
    <div role="tabpanel" class="tab-pane" id="ippackets">
        <div class="list-op" id="list_op">
                        <button type="button" class="btn btn-success" id="btnAdd">
                            新增
                        </button>
                        <button type="button" class="btn btn-danger" id="btnDel">
                            删除
                        </button>
                    </div>
        <table class="table table-striped" id="tablePxe">
            <thead>
                 <tr>
                     <th><input type="checkbox" id="checkAll"></th>
                     <th>规则链</th>
                     <th>ip</th>
                 </tr>
             </thead>
             <tbody>

             <tr>
                 <td><input type="checkbox"></td>
                 <td><select class="selectpicker">
                      <option>INPUT</option>
                      <option>FORWORD</option>
                      <option>OUTPUT</option>
                    </select></td>
                 <td><input value="192.168.1.2"></td>

             </tr>
             <tr>
                 <td><input type="checkbox"></td>
                 <td><select class="selectpicker">
                      <option>INPUT</option>
                      <option>FORWORD</option>
                      <option>OUTPUT</option>
                    </select></td>
                 <td><input value="192.168.1.4"></td>
             </tr>

             </tbody>
         </table>
        <div class="modal-footer">
            <button id="save-net-btn" type="button" class="btn btn-primary">保存</button>
        </div>
    </div>
</div>
{% endblock %}